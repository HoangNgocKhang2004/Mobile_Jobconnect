
<link href="~/css/candidates/topcandidates.css" rel="stylesheet" />

<div class="container">
    <div class="header">
        <h1>Quản lý danh sách ứng viên nổi bật</h1>
    </div>

    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-title">Tổng ứng viên nổi bật</div>
            <div class="stat-value">42</div>
            <div class="stat-subtitle">
                <i class="fas fa-arrow-up positive"></i>
                <span class="positive">12% so với tháng trước</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Tỷ lệ tương thích trung bình</div>
            <div class="stat-value">87%</div>
            <div class="stat-subtitle">
                <i class="fas fa-arrow-up positive"></i>
                <span class="positive">5% so với tháng trước</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Lượt xem hồ sơ</div>
            <div class="stat-value">283</div>
            <div class="stat-subtitle">
                <i class="fas fa-arrow-up positive"></i>
                <span class="positive">18% so với tháng trước</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Tỷ lệ phản hồi</div>
            <div class="stat-value">76%</div>
            <div class="stat-subtitle">
                <i class="fas fa-arrow-down negative"></i>
                <span class="negative">3% so với tháng trước</span>
            </div>
        </div>
    </div>

    <div class="filters">
        <h2>Bộ lọc tìm kiếm</h2>
        <div class="filters-row">
            <div class="filter-group">
                <label for="filter-position">Vị trí ứng tuyển</label>
                <select id="filter-position">
                    <option value="">Tất cả vị trí</option>
                    <option value="developer">Lập trình viên</option>
                    <option value="designer">Thiết kế UI/UX</option>
                    <option value="marketing">Marketing</option>
                    <option value="sales">Kinh doanh</option>
                    <option value="hr">Nhân sự</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-skills">Kỹ năng</label>
                <select id="filter-skills">
                    <option value="">Tất cả kỹ năng</option>
                    <option value="javascript">JavaScript</option>
                    <option value="react">React</option>
                    <option value="nodejs">Node.js</option>
                    <option value="figma">Figma</option>
                    <option value="photoshop">Photoshop</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-experience">Kinh nghiệm</label>
                <select id="filter-experience">
                    <option value="">Tất cả</option>
                    <option value="0-1">0-1 năm</option>
                    <option value="1-3">1-3 năm</option>
                    <option value="3-5">3-5 năm</option>
                    <option value="5+">Trên 5 năm</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-location">Địa điểm</label>
                <select id="filter-location">
                    <option value="">Tất cả</option>
                    <option value="hanoi">Hà Nội</option>
                    <option value="hcmc">TP. Hồ Chí Minh</option>
                    <option value="danang">Đà Nẵng</option>
                </select>
            </div>
        </div>
        <div class="toggle-container">
            <label class="toggle-switch">
                <input type="checkbox" id="ai-recommended" checked>
                <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label">Chỉ hiển thị ứng viên được AI đề xuất</span>
        </div>
        <div class="filter-buttons">
            <button class="btn btn-outline" id="reset-filters">
                <i class="fas fa-rotate"></i> Đặt lại
            </button>
            <button class="btn btn-primary" id="apply-filters">
                <i class="fas fa-filter"></i> Áp dụng bộ lọc
            </button>
        </div>
    </div>

    <div class="table-container">
        <div class="table-header">
            <h2>Danh sách ứng viên nổi bật</h2>
            <div class="table-actions">
                <div class="table-search">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-candidate" placeholder="Tìm kiếm ứng viên...">
                </div>
                <button class="btn btn-outline" id="export-excel">
                    <i class="fas fa-download"></i> Xuất Excel
                </button>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th style="width: 40px;"></th>
                    <th data-sort="name">Ứng viên <i class="fas fa-sort"></i></th>
                    <th>Kỹ năng</th>
                    <th data-sort="rating">Điểm đánh giá <i class="fas fa-sort"></i></th>
                    <th data-sort="match">Độ phù hợp <i class="fas fa-sort"></i></th>
                    <th data-sort="status">Trạng thái <i class="fas fa-sort"></i></th>
                    <th style="width: 100px;">Thao tác</th>
                </tr>
            </thead>
            <tbody id="candidate-table">
                <tr>
                    <td><i class="fas fa-grip-vertical drag-handle"></i></td>
                    <td>
                        <div class="candidate-info">
                            <img src="/api/placeholder/40/40" alt="Avatar" class="candidate-avatar">
                            <div>
                                <div class="candidate-name">Nguyễn Văn A</div>
                                <div class="candidate-position">Senior Frontend Developer</div>
                            </div>
                            <div class="ai-badge">
                                <i class="fas fa-robot"></i> AI đề xuất
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="skill-tag">JavaScript</span>
                        <span class="skill-tag">React</span>
                        <span class="skill-tag">TypeScript</span>
                        <span class="skill-tag">Redux</span>
                    </td>
                    <td>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <span style="margin-left: 5px;">5.0</span>
                        </div>
                    </td>
                    <td><span class="match-score high-match">95%</span></td>
                    <td><span class="status-badge status-active">Đã liên hệ</span></td>
                    <td class="actions-cell">
                        <button class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                        <button class="action-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Thêm vào yêu thích"><i class="far fa-star"></i></button>
                    </td>
                </tr>
                <tr>
                    <td><i class="fas fa-grip-vertical drag-handle"></i></td>
                    <td>
                        <div class="candidate-info">
                            <img src="/api/placeholder/40/40" alt="Avatar" class="candidate-avatar">
                            <div>
                                <div class="candidate-name">Trần Thị B</div>
                                <div class="candidate-position">UI/UX Designer</div>
                            </div>
                            <div class="ai-badge">
                                <i class="fas fa-robot"></i> AI đề xuất
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="skill-tag">Figma</span>
                        <span class="skill-tag">Adobe XD</span>
                        <span class="skill-tag">UI Design</span>
                        <span class="skill-tag">Prototyping</span>
                    </td>
                    <td>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <span style="margin-left: 5px;">4.5</span>
                        </div>
                    </td>
                    <td><span class="match-score high-match">92%</span></td>
                    <td><span class="status-badge status-pending">Đang đánh giá</span></td>
                    <td class="actions-cell">
                        <button class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                        <button class="action-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Thêm vào yêu thích"><i class="far fa-star"></i></button>
                    </td>
                </tr>
                <tr>
                    <td><i class="fas fa-grip-vertical drag-handle"></i></td>
                    <td>
                        <div class="candidate-info">
                            <img src="/api/placeholder/40/40" alt="Avatar" class="candidate-avatar">
                            <div>
                                <div class="candidate-name">Lê Văn C</div>
                                <div class="candidate-position">Backend Developer</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="skill-tag">Node.js</span>
                        <span class="skill-tag">MongoDB</span>
                        <span class="skill-tag">Express</span>
                        <span class="skill-tag">Docker</span>
                    </td>
                    <td>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                            <span style="margin-left: 5px;">4.0</span>
                        </div>
                    </td>
                    <td><span class="match-score medium-match">85%</span></td>
                    <td><span class="status-badge status-new">Mới</span></td>
                    <td class="actions-cell">
                        <button class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                        <button class="action-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Thêm vào yêu thích"><i class="far fa-star"></i></button>
                    </td>
                </tr>
                <tr>
                    <td><i class="fas fa-grip-vertical drag-handle"></i></td>
                    <td>
                        <div class="candidate-info">
                            <img src="/api/placeholder/40/40" alt="Avatar" class="candidate-avatar">
                            <div>
                                <div class="candidate-name">Phạm Thị D</div>
                                <div class="candidate-position">Marketing Specialist</div>
                            </div>
                            <div class="ai-badge">
                                <i class="fas fa-robot"></i> AI đề xuất
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="skill-tag">Digital Marketing</span>
                        <span class="skill-tag">SEO</span>
                        <span class="skill-tag">Content Writing</span>
                        <span class="skill-tag">Analytics</span>
                    </td>
                    <td>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <i class="far fa-star"></i>
                            <span style="margin-left: 5px;">3.5</span>
                        </div>
                    </td>
                    <td><span class="match-score medium-match">78%</span></td>
                    <td><span class="status-badge status-active">Đã liên hệ</span></td>
                    <td class="actions-cell">
                        <button class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                        <button class="action-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Thêm vào yêu thích"><i class="far fa-star"></i></button>
                    </td>
                </tr>
                <tr>
                    <td><i class="fas fa-grip-vertical drag-handle"></i></td>
                    <td>
                        <div class="candidate-info">
                            <img src="/api/placeholder/40/40" alt="Avatar" class="candidate-avatar">
                            <div>
                                <div class="candidate-name">Hoàng Văn E</div>
                                <div class="candidate-position">Project Manager</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="skill-tag">Agile</span>
                        <span class="skill-tag">Scrum</span>
                        <span class="skill-tag">JIRA</span>
                        <span class="skill-tag">Team Management</span>
                    </td>
                    <td>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <span style="margin-left: 5px;">3.0</span>
                        </div>
                    </td>
                    <td><span class="match-score low-match">65%</span></td>
                    <td><span class="status-badge status-pending">Đang đánh giá</span></td>
                    <td class="actions-cell">
                        <button class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                        <button class="action-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Thêm vào yêu thích"><i class="far fa-star"></i></button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="pagination">
            <div class="pagination-info">
                Hiển thị 1-5 trong tổng số 42 ứng viên
            </div>
            <div class="pagination-controls">
                <button class="page-btn disabled" id="prev-page"><i class="fas fa-chevron-left"></i></button>
                <button class="page-btn active" data-page="1">1</button>
                <button class="page-btn" data-page="2">2</button>
                <button class="page-btn" data-page="3">3</button>
                <button class="page-btn" id="next-page"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Dữ liệu mẫu (giả lập)
        let candidates = [
            {
                name: "Nguyễn Văn A",
                position: "Senior Frontend Developer",
                skills: ["JavaScript", "React", "TypeScript", "Redux"],
                rating: 5.0,
                match: 95,
                status: "Đã liên hệ",
                aiRecommended: true
            },
            {
                name: "Trần Thị B",
                position: "UI/UX Designer",
                skills: ["Figma", "Adobe XD", "UI Design", "Prototyping"],
                rating: 4.5,
                match: 92,
                status: "Đang đánh giá",
                aiRecommended: true
            },
            {
                name: "Lê Văn C",
                position: "Backend Developer",
                skills: ["Node.js", "MongoDB", "Express", "Docker"],
                rating: 4.0,
                match: 85,
                status: "Mới",
                aiRecommended: false
            },
            {
                name: "Phạm Thị D",
                position: "Marketing Specialist",
                skills: ["Digital Marketing", "SEO", "Content Writing", "Analytics"],
                rating: 3.5,
                match: 78,
                status: "Đã liên hệ",
                aiRecommended: true
            },
            {
                name: "Hoàng Văn E",
                position: "Project Manager",
                skills: ["Agile", "Scrum", "JIRA", "Team Management"],
                rating: 3.0,
                match: 65,
                status: "Đang đánh giá",
                aiRecommended: false
            }
        ];

        let currentPage = 1;
        const itemsPerPage = 5;
        let filteredCandidates = [...candidates];

        // Hàm hiển thị danh sách ứng viên
        function renderCandidates(data) {
            const tbody = $("#candidate-table");
            tbody.empty();

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedData = data.slice(start, end);

            paginatedData.forEach(candidate => {
                const row = `
                    <tr>
                        <td><i class="fas fa-grip-vertical drag-handle"></i></td>
                        <td>
                            <div class="candidate-info">
                                <img src="/api/placeholder/40/40" alt="Avatar" class="candidate-avatar">
                                <div>
                                    <div class="candidate-name">${candidate.name}</div>
                                    <div class="candidate-position">${candidate.position}</div>
                                </div>
                                ${candidate.aiRecommended ? '<div class="ai-badge"><i class="fas fa-robot"></i> AI đề xuất</div>' : ''}
                            </div>
                        </td>
                        <td>
                            ${candidate.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join("")}
                        </td>
                        <td>
                            <div class="rating">
                                ${Array(Math.floor(candidate.rating)).fill('<i class="fas fa-star"></i>').join("")}
                                ${candidate.rating % 1 !== 0 ? '<i class="fas fa-star-half-alt"></i>' : ''}
                                ${Array(5 - Math.ceil(candidate.rating)).fill('<i class="far fa-star"></i>').join("")}
                                <span style="margin-left: 5px;">${candidate.rating.toFixed(1)}</span>
                            </div>
                        </td>
                        <td><span class="match-score ${candidate.match >= 90 ? 'high-match' : candidate.match >= 80 ? 'medium-match' : 'low-match'}">${candidate.match}%</span></td>
                        <td><span class="status-badge status-${candidate.status === 'Đã liên hệ' ? 'active' : candidate.status === 'Đang đánh giá' ? 'pending' : 'new'}">${candidate.status}</span></td>
                        <td class="actions-cell">
                            <button class="action-btn" title="Xem chi tiết"><i class="fas fa-eye"></i></button>
                            <button class="action-btn" title="Chỉnh sửa"><i class="fas fa-edit"></i></button>
                            <button class="action-btn" title="Thêm vào yêu thích"><i class="far fa-star"></i></button>
                        </td>
                    </tr>
                `;
                tbody.append(row);
            });

            updatePagination(data.length);
        }

        // Hàm cập nhật phân trang
        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationControls = $(".pagination-controls");
            paginationControls.empty();

            paginationControls.append(`
                <button class="page-btn ${currentPage === 1 ? 'disabled' : ''}" id="prev-page"><i class="fas fa-chevron-left"></i></button>
            `);

            for (let i = 1; i <= totalPages; i++) {
                paginationControls.append(`
                    <button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</button>
                `);
            }

            paginationControls.append(`
                <button class="page-btn ${currentPage === totalPages ? 'disabled' : ''}" id="next-page"><i class="fas fa-chevron-right"></i></button>
            `);

            $(".pagination-info").text(`Hiển thị ${Math.min((currentPage - 1) * itemsPerPage + 1, totalItems)}-${Math.min(currentPage * itemsPerPage, totalItems)} trong tổng số ${totalItems} ứng viên`);
        }

        // Xử lý tìm kiếm
        $("#search-candidate").on("input", function () {
            const searchTerm = $(this).val().toLowerCase();
            filteredCandidates = candidates.filter(candidate =>
                candidate.name.toLowerCase().includes(searchTerm) ||
                candidate.position.toLowerCase().includes(searchTerm) ||
                candidate.skills.some(skill => skill.toLowerCase().includes(searchTerm))
            );
            currentPage = 1;
            renderCandidates(filteredCandidates);
        });

        // Xử lý bộ lọc
        $("#apply-filters").click(function () {
            const position = $("#filter-position").val();
            const skill = $("#filter-skills").val();
            const experience = $("#filter-experience").val();
            const location = $("#filter-location").val();
            const aiRecommended = $("#ai-recommended").is(":checked");

            filteredCandidates = candidates.filter(candidate => {
                let match = true;

                if (position && !candidate.position.toLowerCase().includes(position.toLowerCase())) {
                    match = false;
                }
                if (skill && !candidate.skills.some(s => s.toLowerCase().includes(skill.toLowerCase()))) {
                    match = false;
                }
                if (experience) {
                    // Giả lập logic kinh nghiệm
                    match = false; // Cần thêm logic thực tế
                }
                if (location) {
                    // Giả lập logic địa điểm
                    match = false; // Cần thêm logic thực tế
                }
                if (aiRecommended && !candidate.aiRecommended) {
                    match = false;
                }

                return match;
            });

            currentPage = 1;
            renderCandidates(filteredCandidates);
        });

        // Đặt lại bộ lọc
        $("#reset-filters").click(function () {
            $("#filter-position").val("");
            $("#filter-skills").val("");
            $("#filter-experience").val("");
            $("#filter-location").val("");
            $("#ai-recommended").prop("checked", false);
            filteredCandidates = [...candidates];
            currentPage = 1;
            renderCandidates(filteredCandidates);
        });

        // Xử lý phân trang
        $(document).on("click", ".page-btn[data-page]", function () {
            currentPage = parseInt($(this).data("page"));
            renderCandidates(filteredCandidates);
        });

        $(document).on("click", "#prev-page", function () {
            if (currentPage > 1) {
                currentPage--;
                renderCandidates(filteredCandidates);
            }
        });

        $(document).on("click", "#next-page", function () {
            const totalPages = Math.ceil(filteredCandidates.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderCandidates(filteredCandidates);
            }
        });

        // Xử lý sắp xếp
        $("thead th[data-sort]").click(function () {
            const sortKey = $(this).data("sort");
            const isAsc = $(this).hasClass("sort-asc");

            filteredCandidates.sort((a, b) => {
                let valA = a[sortKey];
                let valB = b[sortKey];

                if (sortKey === "name") {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                } else if (sortKey === "status") {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (valA < valB) return isAsc ? -1 : 1;
                if (valA > valB) return isAsc ? 1 : -1;
                return 0;
            });

            $("thead th").removeClass("sort-asc sort-desc");
            $(this).addClass(isAsc ? "sort-desc" : "sort-asc");

            renderCandidates(filteredCandidates);
        });

        // Kéo thả sắp xếp hàng
        new Sortable(document.getElementById("candidate-table"), {
            handle: ".drag-handle",
            animation: 150,
            onEnd: function (evt) {
                const oldIndex = evt.oldIndex;
                const newIndex = evt.newIndex;
                const [movedItem] = filteredCandidates.splice(oldIndex, 1);
                filteredCandidates.splice(newIndex, 0, movedItem);
                renderCandidates(filteredCandidates);
            }
        });

        // Xuất Excel (giả lập)
        $("#export-excel").click(function () {
            alert("Chức năng xuất Excel đang được phát triển!");
        });

        // Khởi tạo
        renderCandidates(filteredCandidates);
    });
</script>
