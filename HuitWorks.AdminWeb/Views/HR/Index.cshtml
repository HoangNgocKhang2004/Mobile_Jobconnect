@model List<HuitWorks.AdminWeb.Models.ViewModels.HRCompanyViewModel>

<link href="~/css/hr/index.css" rel="stylesheet" />

<div class="row mb-4">
    <!-- Tổng số tài khoản -->
    <div class="col-md-3">
        <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                        Tổng số tài khoản
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                        @ViewBag.TotalAccounts
                    </div>
                    <p class="mb-0 text-muted">
                        <i class="fas fa-arrow-up me-1"></i>12% trong tháng này
                    </p>
                </div>
                <i class="fas fa-users fa-2x text-gray-300"></i>
            </div>
        </div>
    </div>

    <!-- Tài khoản chờ xác thực -->
    <div class="col-md-3">
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                        Tài khoản chờ xác thực
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                        @ViewBag.PendingAccounts
                    </div>
                    <p class="mb-0 text-muted">
                        <i class="fas fa-arrow-down me-1"></i>5% so với tuần trước
                    </p>
                </div>
                <i class="fas fa-user-clock fa-2x text-gray-300"></i>
            </div>
        </div>
    </div>

    <!-- Nhà tuyển dụng (active) -->
    <div class="col-md-3">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                        Nhà tuyển dụng
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                        @ViewBag.EmployersCount
                    </div>
                    <p class="mb-0 text-muted">
                        <i class="fas fa-arrow-up me-1"></i>8% trong tháng này
                    </p>
                </div>
                <i class="fas fa-building fa-2x text-gray-300"></i>
            </div>
        </div>
    </div>

    <!-- Dịch vụ đã sử dụng -->
    <div class="col-md-3">
        <div class="card border-left-danger shadow h-100 py-2">
            <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                        Dịch vụ đã sử dụng
                    </div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                        @ViewBag.ServicesUsedCount
                    </div>
                    <p class="mb-0 text-muted">
                        <i class="fas fa-arrow-up me-1"></i>8% trong tháng này
                    </p>
                </div>
                <i class="fas fa-concierge-bell fa-2x text-gray-300"></i>
            </div>
        </div>
    </div>
</div>


<!-- Recent Users -->
<!-- Danh sách HR Companies -->
<div class="row">
    <div class="col-12 mb-4">
        <div class="activity-card card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5>Danh sách nhà tuyển dụng</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary me-2">
                            <i class="fas fa-filter me-1"></i>Lọc
                        </button>
                        <button class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-download me-1"></i>Xuất
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <div class="table-responsive shadow-sm rounded mb-4">
                        <table class="table table-striped table-hover align-middle mb-0">
                            <thead style="background-color: #F3F6FA">
                                <tr>
                                    @* <th class="text-center">Mã công ty</th> *@
                                    <th>Tên công ty</th>
                                    @* <th class="text-center">Mã HR</th> *@
                                    <th>Nhân sự HR</th>
                                    <th>Email</th>
                                    <th>Phòng ban</th>
                                    <th>Chức danh</th>
                                    <th class="text-center">Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        @* <td class="text-center"> *@
                                        @*     <span class="badge bg-secondary">@item.IdCompany</span> *@
                                        @* </td> *@
                                        <td>
                                            <i class="fas fa-building text-info me-1"></i>
                                            <span class="fw-semibold text-primary">@item.CompanyName</span>
                                        </td>
                                        @* <td class="text-center"> *@
                                        @*     <span class="badge bg-secondary">@item.IdUser</span> *@
                                        @* </td> *@
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="rounded-circle bg-primary text-white d-flex justify-content-center align-items-center me-2"
                                                     style="width:32px; height:32px; font-weight:600;">
                                                    @(!string.IsNullOrEmpty(item.UserName)
                                                        ? item.UserName.Substring(0, 1).ToUpper()
                                                        : "N")
                                                </div>
                                                <span class="fw-medium">@item.UserName</span>
                                            </div>
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(item.Email))
                                            {
                                                <a href="mailto:@item.Email" class="text-decoration-none">
                                                    <i class="fas fa-envelope me-1"></i>
                                                    @item.Email
                                                </a>
                                            }
                                            else
                                            {
                                                <span class="text-muted">-</span>
                                            }
                                        </td>
                                        <td>
                                            <span class="badge bg-info text-dark">@item.Department</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-success">@item.Title</span>
                                        </td>
                                        <td class="text-center">
                                            @* <a asp-action="Edit" asp-route-id="@item.IdUser" *@
                                            @*    class="btn btn-sm btn-outline-warning" title="Chỉnh sửa"> *@
                                            @*     <i class="fas fa-edit"></i> *@
                                            @* </a> *@
                                            <a asp-action="Details" asp-route-id="@item.IdCompany"
                                               class="btn btn-sm btn-outline-primary ms-1" title="Xem chi tiết">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>


                    <div class="pagination">
                        <div class="page-info">
                            Trang @ViewBag.CurrentPage / @ViewBag.TotalPages
                        </div>

                        <div class="page-buttons">
                            @if ((int)ViewBag.CurrentPage > 1)
                            {
                                <a href="?page=@((int)ViewBag.CurrentPage - 1)" class="page-btn">
                                    <i class="fas fa-angle-left"></i>
                                </a>
                            }

                            @for (int i = 1; i <= ViewBag.TotalPages; i++)
                            {
                                if (i == 1 || i == ViewBag.TotalPages || (i >= ViewBag.CurrentPage - 1 && i <= ViewBag.CurrentPage + 1))
                                {
                                    <a href="?page=@i" class="page-btn @(i == ViewBag.CurrentPage ? "active" : "")">@i</a>
                                }
                                else if (i == 2 || i == ViewBag.TotalPages - 1)
                                {
                                    <span class="page-btn">...</span>
                                }
                            }

                            @if ((int)ViewBag.CurrentPage < (int)ViewBag.TotalPages)
                            {
                                <a href="?page=@((int)ViewBag.CurrentPage + 1)" class="page-btn">
                                    <i class="fas fa-angle-right"></i>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Activity & Stats -->
<div class="row">
    <div class="col-lg-8 mb-4">
        <div class="activity-card card h-100">
            <div class="card-header">
                <div class="recent-activity-title">
                    <h5>Hoạt động gần đây</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="activityFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Hôm nay
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="activityFilterDropdown">
                            <li><a class="dropdown-item" href="#">Hôm nay</a></li>
                            <li><a class="dropdown-item" href="#">Tuần này</a></li>
                            <li><a class="dropdown-item" href="#">Tháng này</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-item-marker">
                            <div class="timeline-item-marker-text">1h trước</div>
                            <div class="timeline-item-marker-indicator bg-success"></div>
                        </div>
                        <div class="timeline-item-content">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="fw-bold">nguyenvan@company.com</span> đã được xác thực thành công
                                    <div class="text-muted small">Đã xác minh bởi Admin</div>
                                </div>
                                <div>
                                    <span class="badge bg-success">Đã xác thực</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-item-marker">
                            <div class="timeline-item-marker-text">3h trước</div>
                            <div class="timeline-item-marker-indicator bg-warning"></div>
                        </div>
                        <div class="timeline-item-content">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="fw-bold">company@recruit.com</span> đã gửi yêu cầu xác thực
                                    <div class="text-muted small">Đang chờ duyệt</div>
                                </div>
                                <div>
                                    <span class="badge bg-warning text-dark">Chờ xác thực</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-item-marker">
                            <div class="timeline-item-marker-text">5h trước</div>
                            <div class="timeline-item-marker-indicator bg-danger"></div>
                        </div>
                        <div class="timeline-item-content">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="fw-bold">spammer123@mail.com</span> đã bị khóa do vi phạm
                                    <div class="text-muted small">Khóa bởi hệ thống</div>
                                </div>
                                <div>
                                    <span class="badge bg-danger">Bị khóa</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-item-marker">
                            <div class="timeline-item-marker-text">8h trước</div>
                            <div class="timeline-item-marker-indicator bg-info"></div>
                        </div>
                        <div class="timeline-item-content">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="fw-bold">tuyendung@hr.com</span> đã đăng ký tài khoản mới
                                    <div class="text-muted small">Vai trò: Nhà tuyển dụng</div>
                                </div>
                                <div>
                                    <span class="badge bg-info">Tài khoản mới</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <button class="btn btn-sm btn-outline-primary">Xem tất cả hoạt động</button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4 mb-4">
        <div class="activity-card card h-100">
            <div class="card-header">
                <h5>Phân loại người dùng</h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="userTypePieChart"></canvas>
                </div>
                <div class="user-type-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #4361ee;"></div>
                        <div>Ứng viên (65%)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #4cc9f0;"></div>
                        <div>Nhà tuyển dụng (30%)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #f72585;"></div>
                        <div>Admin (5%)</div>
                    </div>
                </div>
                <div class="card mt-4 border-0 bg-light">
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <div class="text-muted">Ứng viên</div>
                            <div class="fw-bold">159</div>
                        </div>
                        <div class="progress mb-3" style="height: 6px;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 65%;" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <div class="text-muted">Nhà tuyển dụng</div>
                            <div class="fw-bold">78</div>
                        </div>
                        <div class="progress mb-3" style="height: 6px;">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 30%;" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <div class="text-muted">Admin</div>
                            <div class="fw-bold">8</div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-danger" role="progressbar" style="width: 5%;" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // User Type Pie Chart
    var ctx = document.getElementById('userTypePieChart').getContext('2d');
    var userTypePieChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Ứng viên', 'Nhà tuyển dụng', 'Admin'],
            datasets: [{
                data: [65, 30, 5],
                backgroundColor: [
                    '#4361ee',
                    '#4cc9f0',
                    '#f72585'
                ],
                borderWidth: 0,
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
</script>